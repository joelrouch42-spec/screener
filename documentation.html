<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š Documentation - Stock Screener</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            margin-top: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        h2 {
            color: #e74c3c;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.8em;
            padding: 10px 0;
            border-left: 5px solid #e74c3c;
            padding-left: 15px;
            background: linear-gradient(90deg, rgba(231,76,60,0.1) 0%, transparent 100%);
        }

        h3 {
            color: #27ae60;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        h4 {
            color: #8e44ad;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .overview {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .mode-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .mode-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-top: 4px solid #3498db;
        }

        .mode-card.scanner {
            border-top-color: #e74c3c;
        }

        .file-structure {
            background: #2d3436;
            color: #00b894;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            overflow-x: auto;
            font-size: 0.95em;
        }

        .code-block {
            background: #2d3436;
            color: #ddd;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            border-left: 4px solid #74b9ff;
        }

        .code-comment {
            color: #636e72;
            font-style: italic;
        }

        .highlight {
            background: #ffeaa7;
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: #2d3436;
        }

        .important {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #fff;
        }

        .info-box {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #fff;
        }

        .warning {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #fff;
        }

        .success {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #fff;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        th {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .toc {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid #ddd;
        }

        .toc ul {
            list-style: none;
            padding-left: 0;
        }

        .toc li {
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .toc a {
            color: #2980b9;
            text-decoration: none;
            font-weight: 500;
        }

        .toc a:hover {
            color: #3498db;
            text-decoration: underline;
        }

        .flow-diagram {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }

        .command-box {
            background: #2d3436;
            color: #00b894;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            border-left: 4px solid #00b894;
        }

        .error-help {
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .feature-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 3px solid #3498db;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }

            h1 {
                font-size: 2em;
            }

            h2 {
                font-size: 1.5em;
            }

            .mode-comparison {
                grid-template-columns: 1fr;
            }

            .code-block, .file-structure, .command-box {
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Documentation - Stock Screener</h1>

        <div class="overview">
            <h3>ğŸ¯ Vue d'ensemble</h3>
            <p><strong>SystÃ¨me complet de surveillance des marchÃ©s financiers avec DEUX modes :</strong></p>
            <ul style="text-align: left; margin-top: 15px;">
                <li>ğŸ–¥ï¸ <strong>GUI Dashboard</strong> : Interface web interactive avec graphiques et analyse visuelle dÃ©taillÃ©e</li>
                <li>âš¡ <strong>CLI Scanner</strong> : Surveillance continue en arriÃ¨re-plan avec alertes uniquement (mode silencieux)</li>
            </ul>
        </div>

        <div class="mode-comparison">
            <div class="mode-card">
                <h3>ğŸ–¥ï¸ Mode GUI Dashboard</h3>
                <p><strong>Fichier :</strong> <code>tabs.py</code></p>
                <p><strong>Usage :</strong></p>
                <div class="code-block">python3 tabs.py [config.txt]</div>
                <p><strong>AccÃ¨s :</strong> http://localhost:8050</p>
                <p><strong>IdÃ©al pour :</strong></p>
                <ul style="text-align: left;">
                    <li>Analyse graphique dÃ©taillÃ©e</li>
                    <li>Visualisation historique</li>
                    <li>Support/RÃ©sistance interactifs</li>
                    <li>Journal des catalyseurs</li>
                </ul>
            </div>

            <div class="mode-card scanner">
                <h3>âš¡ Mode CLI Scanner</h3>
                <p><strong>Fichier :</strong> <code>scanner.py</code></p>
                <p><strong>Usage :</strong></p>
                <div class="code-block">python3 scanner.py [scanner_config.txt]</div>
                <p><strong>ContrÃ´le :</strong></p>
                <div class="code-block">./run_scanner.sh [start|stop|status]</div>
                <p><strong>IdÃ©al pour :</strong></p>
                <ul style="text-align: left;">
                    <li>Surveillance continue 24/7</li>
                    <li>Mode silencieux (alertes seulement)</li>
                    <li>Performance optimale</li>
                    <li>DÃ©ploiement serveur</li>
                </ul>
            </div>
        </div>

        <div class="toc">
            <h3>ğŸ“‹ Table des matiÃ¨res</h3>
            <ul>
                <li><a href="#structure">ğŸ“ Structure des fichiers</a></li>
                <li><a href="#modes">ğŸ”€ Deux modes d'utilisation</a></li>
                <li><a href="#config">âš™ï¸ Fichiers de configuration</a></li>
                <li><a href="#settings">ğŸ›ï¸ settings.json - Configuration avancÃ©e</a></li>
                <li><a href="#tabs">ğŸ–¥ï¸ tabs.py - Le Dashboard GUI</a></li>
                <li><a href="#scanner">âš¡ scanner.py - Le Scanner CLI</a></li>
                <li><a href="#catalyst">ğŸ” catalyst_analyzer.py - DÃ©tection IA</a></li>
                <li><a href="#backtest">ğŸ“ˆ backtest_catalysts.py - Backtesting</a></li>
                <li><a href="#providers">ğŸ“Š data_providers.py - Sources de donnÃ©es</a></li>
                <li><a href="#alerts">ğŸš¨ Types d'alertes</a></li>
                <li><a href="#filters">ğŸ¯ Profils de filtrage</a></li>
                <li><a href="#cache">ğŸ’¾ SystÃ¨me de cache intelligent</a></li>
                <li><a href="#commands">ğŸ› ï¸ Commandes utiles</a></li>
                <li><a href="#debug">ğŸ› DÃ©pannage</a></li>
            </ul>
        </div>

        <h2 id="structure">ğŸ“ Structure des fichiers</h2>
        <div class="file-structure">
/home/user/screener/
â”œâ”€â”€ tabs.py                  <span class="code-comment"># ğŸ–¥ï¸  Dashboard GUI (758 lignes)</span>
â”œâ”€â”€ scanner.py               <span class="code-comment"># âš¡ Scanner CLI optimisÃ© (610 lignes)</span>
â”œâ”€â”€ catalyst_analyzer.py     <span class="code-comment"># ğŸ” DÃ©tection catalyseurs avec IA (353 lignes)</span>
â”œâ”€â”€ backtest_catalysts.py    <span class="code-comment"># ğŸ“ˆ Module de backtesting (284 lignes)</span>
â”œâ”€â”€ data_providers.py        <span class="code-comment"># ğŸ“Š Multi-sources (Yahoo, Polygon) (314 lignes)</span>
â”œâ”€â”€ ibkr_provider.py         <span class="code-comment"># ğŸ’¼ Provider Interactive Brokers (310 lignes)</span>
â”œâ”€â”€ market_utils.py          <span class="code-comment"># ğŸ• Utilitaires heures de marchÃ© (124 lignes)</span>
â”œâ”€â”€ find_examples.py         <span class="code-comment"># ğŸ” Recherche d'exemples historiques</span>
â”‚
â”œâ”€â”€ settings.json            <span class="code-comment"># âš™ï¸  Config principale (seuils, profils, cache)</span>
â”œâ”€â”€ config.txt               <span class="code-comment"># ğŸ“‹ Symboles pour GUI Dashboard</span>
â”œâ”€â”€ scanner_config.txt       <span class="code-comment"># ğŸ“‹ Symboles pour Scanner CLI (plus nombreux)</span>
â”œâ”€â”€ sector_mapping.txt       <span class="code-comment"># ğŸ¢ Classification par secteur</span>
â”œâ”€â”€ signal_types.json        <span class="code-comment"># ğŸ·ï¸  DÃ©finition des types de signaux</span>
â”‚
â”œâ”€â”€ run_scanner.sh           <span class="code-comment"># ğŸš€ ContrÃ´le scanner (start/stop/status)</span>
â”œâ”€â”€ screener_control.sh      <span class="code-comment"># ğŸ›ï¸  Script de contrÃ´le gÃ©nÃ©ral</span>
â”œâ”€â”€ remote_control.sh        <span class="code-comment"># ğŸŒ ContrÃ´le Ã  distance</span>
â””â”€â”€ documentation.html       <span class="code-comment"># ğŸ“š Cette documentation</span>
        </div>

        <div class="important">
            <strong>ğŸ’¡ Architecture modulaire :</strong><br>
            ~2800 lignes de code Python rÃ©parties en 8 modules spÃ©cialisÃ©s
        </div>

        <h2 id="modes">ğŸ”€ Deux modes d'utilisation</h2>

        <h3>ğŸ–¥ï¸ Mode GUI Dashboard (tabs.py)</h3>
        <div class="info-box">
            <strong>Quand l'utiliser :</strong><br>
            â€¢ Pendant les heures de trading pour suivre vos positions<br>
            â€¢ Analyse technique approfondie avec graphiques<br>
            â€¢ Ã‰tude des niveaux de Support/RÃ©sistance<br>
            â€¢ Consultation de l'historique des catalyseurs
        </div>

        <h4>FonctionnalitÃ©s GUI :</h4>
        <div class="feature-grid">
            <div class="feature-card">
                <strong>ğŸ“Š Graphiques Plotly</strong><br>
                Chandeliers japonais interactifs
            </div>
            <div class="feature-card">
                <strong>ğŸ“ Support/RÃ©sistance</strong><br>
                DÃ©tection automatique des niveaux
            </div>
            <div class="feature-card">
                <strong>ğŸ“° Journal catalyseurs</strong><br>
                Historique des Ã©vÃ©nements
            </div>
            <div class="feature-card">
                <strong>âš¡ Breakout alerts</strong><br>
                Cassures de niveaux en temps rÃ©el
            </div>
            <div class="feature-card">
                <strong>ğŸ”„ Auto-refresh</strong><br>
                Mise Ã  jour toutes les 60 secondes
            </div>
            <div class="feature-card">
                <strong>ğŸ“± Multi-onglets</strong><br>
                Plusieurs symboles simultanÃ©s
            </div>
            <div class="feature-card">
                <strong>ğŸ“ˆ Î”% Moy/Seuil</strong><br>
                Affiche moyenne mouvement + seuil dynamique
            </div>
            <div class="feature-card">
                <strong>ğŸ“œ Catalyst Log</strong><br>
                Historique 365 jours des catalyseurs
            </div>
        </div>

        <h3>âš¡ Mode CLI Scanner (scanner.py)</h3>
        <div class="warning">
            <strong>Quand l'utiliser :</strong><br>
            â€¢ Surveillance continue en arriÃ¨re-plan<br>
            â€¢ Serveur de production (VPS, cloud)<br>
            â€¢ Notifications d'alertes uniquement<br>
            â€¢ Performance maximale avec cache intelligent
        </div>

        <h4>Avantages du Scanner :</h4>
        <ul>
            <li>ğŸ”‡ <strong>Mode silencieux</strong> : Aucun log technique, alertes uniquement</li>
            <li>ğŸ’¾ <strong>Cache partagÃ©</strong> : Ã‰vite les recalculs S/R permanents</li>
            <li>âš¡ <strong>OptimisÃ©</strong> : Peut surveiller 50+ symboles sans ralentir</li>
            <li>ğŸ”„ <strong>Daemon mode</strong> : Tourne en arriÃ¨re-plan avec run_scanner.sh</li>
            <li>ğŸ“Š <strong>MÃªme intelligence</strong> : Utilise le mÃªme dÃ©tecteur de catalyseurs</li>
        </ul>

        <h2 id="config">âš™ï¸ Fichiers de configuration</h2>

        <h3>config.txt (GUI Dashboard)</h3>
        <div class="code-block">
<span class="code-comment"># Format: SYMBOL PROVIDER</span>
VSME auto
NVDA auto
AAPL auto
TSLA auto
        </div>
        <div class="highlight">Usage :</div> Liste des actions Ã  afficher dans l'interface web

        <h3>scanner_config.txt (Scanner CLI)</h3>
        <div class="code-block">
<span class="code-comment"># Format identique mais liste plus Ã©tendue</span>
VSME auto
NVDA auto
AAPL auto
MSFT auto
GOOGL auto
<span class="code-comment"># ... peut contenir 50+ symboles</span>
        </div>
        <div class="highlight">Usage :</div> Liste des actions surveillÃ©es par le scanner en continu

        <h3>sector_mapping.txt</h3>
        <div class="code-block">
NVDA tech
AAPL tech
RYTM biotech
COIN crypto
JPM finance
        </div>
        <div class="highlight">Usage :</div> Classification par secteur pour l'analyse contextuelle IA

        <h2 id="settings">ğŸ›ï¸ settings.json - Configuration avancÃ©e</h2>

        <h3>Sections principales :</h3>

        <h4>ğŸš¨ Catalyst (DÃ©tection de catalyseurs)</h4>
        <div class="code-block">
"catalyst": {
  "multiplier": 1.5,          <span class="code-comment">// Seuil dynamique = moyenne * multiplier</span>
  "min_threshold": 1.0,       <span class="code-comment">// Seuil minimum en %</span>
  "news_days": 1,             <span class="code-comment">// Nombre de jours de news Ã  analyser</span>
  "recent_alerts_days": 7     <span class="code-comment">// PÃ©riode alertes rÃ©centes</span>
}
        </div>

        <h4>ğŸ“Š Analysis (Analyse technique)</h4>
        <div class="code-block">
"analysis": {
  "avg_candles": 30,               <span class="code-comment">// Moyenne sur 30 bougies</span>
  "volume_spike_threshold": 1.5,   <span class="code-comment">// Volume requis (1.5x moyenne)</span>
  "volume_min_candles": 5          <span class="code-comment">// Minimum de bougies pour moyenne</span>
}
        </div>

        <h4>ğŸ”§ Breakout (Cassures de niveaux)</h4>
        <div class="code-block">
"breakout": {
  "min_move_percent": 1.0,        <span class="code-comment">// Mouvement minimum requis</span>
  "volume_spike_threshold": 1.5   <span class="code-comment">// Volume spike obligatoire</span>
}
        </div>

        <h4>ğŸ“ Support/Resistance (DÃ©tection S/R)</h4>
        <div class="code-block">
"support_resistance": {
  "order": 5,                <span class="code-comment">// SensibilitÃ© dÃ©tection (5 = moyen)</span>
  "cluster_threshold": 0.02  <span class="code-comment">// Regroupement niveaux (2%)</span>
}
        </div>

        <h4>ğŸ”‡ Logging (Mode silencieux)</h4>
        <div class="code-block">
"logging": {
  "debug": false,
  "alerts_only": true    <span class="code-comment">// âœ… Mode silencieux : uniquement alertes</span>
}
        </div>

        <div class="important">
            <strong>âš™ï¸ Mode silencieux activÃ© par dÃ©faut !</strong><br>
            â€¢ <code>"alerts_only": true</code> supprime tous les logs techniques<br>
            â€¢ Seules les alertes de catalyseurs et breakouts sont affichÃ©es<br>
            â€¢ IdÃ©al pour surveillance continue sans pollution de logs
        </div>

        <h2 id="filters">ğŸ¯ Profils de filtrage des signaux</h2>

        <div class="info-box">
            <strong>Nouveau systÃ¨me de filtrage avancÃ© !</strong><br>
            Choisissez un profil dans settings.json pour filtrer les alertes selon vos critÃ¨res.
        </div>

        <h3>Profils disponibles :</h3>

        <table>
            <thead>
                <tr>
                    <th>Profil</th>
                    <th>Description</th>
                    <th>Cas d'usage</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>no_filters</code></td>
                    <td>Aucun filtre - toutes les alertes passent</td>
                    <td>Mode dÃ©couverte, testing</td>
                </tr>
                <tr>
                    <td><code>breakouts_only</code></td>
                    <td>Uniquement breakouts techniques avec volume</td>
                    <td>Trading momentum</td>
                </tr>
                <tr>
                    <td><code>high_confidence</code></td>
                    <td>Signaux trÃ¨s fiables (earnings, FDA, acquisitions)</td>
                    <td>Swing trading conservateur</td>
                </tr>
                <tr>
                    <td><code>balanced</code> â­</td>
                    <td>Ã‰quilibre qualitÃ©/quantitÃ© - RECOMMANDÃ‰</td>
                    <td>Usage quotidien gÃ©nÃ©ral</td>
                </tr>
                <tr>
                    <td><code>tech_focus</code></td>
                    <td>Tech stocks uniquement, mouvements >2%</td>
                    <td>SpÃ©cialisation secteur tech</td>
                </tr>
                <tr>
                    <td><code>earnings_season</code></td>
                    <td>SpÃ©cial earnings, gros mouvements >3%</td>
                    <td>PÃ©riode de rÃ©sultats trimestriels</td>
                </tr>
            </tbody>
        </table>

        <h3>Activer un profil :</h3>
        <div class="code-block">
"signal_filters": {
  "active_profile": "balanced",   <span class="code-comment">// Changez ici</span>
  "profiles": {
    "balanced": {
      "enabled": true,
      "allowed_breakout_types": ["resistance_breakout", "support_breakdown"],
      "allowed_catalyst_types": ["earnings", "contract", "fda", "acquisition"],
      "blocked_catalyst_types": ["unknown", "technical"],
      "min_reliability": "medium",
      "min_change_percent": 1.5,
      "require_volume_spike": true,
      "allowed_sectors": ["tech", "biotech", "finance", "crypto"]
    }
  }
}
        </div>

        <h2 id="cache">ğŸ’¾ SystÃ¨me de cache intelligent</h2>

        <div class="success">
            <strong>ğŸš€ Optimisation majeure !</strong><br>
            Le systÃ¨me de cache Ã©vite de recalculer les niveaux S/R en permanence.
        </div>

        <h3>Fonctionnement du cache :</h3>
        <ul>
            <li>ğŸ”„ <strong>Cache partagÃ©</strong> : GUI et Scanner utilisent les mÃªmes donnÃ©es (LevelsCache)</li>
            <li>â° <strong>TTL 4 heures</strong> : DonnÃ©es expirÃ©es aprÃ¨s 4 heures</li>
            <li>ğŸ“Š <strong>Niveaux S/R persistants</strong> : Ã‰vite le recalcul inutile</li>
            <li>ğŸ’¾ <strong>En mÃ©moire</strong> : Pas d'Ã©criture disque, ultra rapide</li>
            <li>ğŸ¯ <strong>Refresh intelligent</strong> : Recalcul auto si prix bouge >5%</li>
        </ul>

        <h3>Avantages :</h3>
        <div class="feature-grid">
            <div class="feature-card">
                <strong>âš¡ Performance</strong><br>
                50+ symboles sans ralentir
            </div>
            <div class="feature-card">
                <strong>ğŸŒ API Ã©conomie</strong><br>
                Moins de requÃªtes aux providers
            </div>
            <div class="feature-card">
                <strong>ğŸ”„ CohÃ©rence</strong><br>
                MÃªmes niveaux S/R partout
            </div>
            <div class="feature-card">
                <strong>â™»ï¸ Auto-cleanup</strong><br>
                Gestion mÃ©moire automatique
            </div>
        </div>

        <h2 id="tabs">ğŸ–¥ï¸ tabs.py - Le Dashboard GUI</h2>

        <h3>Architecture :</h3>
        <div class="code-block">
class LevelsCache:
    get_levels()              <span class="code-comment"># RÃ©cupÃ¨re niveaux S/R en cache (TTL 4h)</span>
    set_levels()              <span class="code-comment"># Sauvegarde niveaux en cache</span>
    should_refresh_levels()   <span class="code-comment"># VÃ©rifie si prix a bougÃ© >5%</span>

class ChartData:
    fetch_data()              <span class="code-comment"># TÃ©lÃ©charge historique complet</span>
    fetch_latest_candle()     <span class="code-comment"># OptimisÃ©: seulement derniÃ¨re bougie</span>
    calculate_metrics()       <span class="code-comment"># Calcule moyennes, volatilitÃ©, etc.</span>

class SupportResistance:
    find_levels()             <span class="code-comment"># DÃ©tecte niveaux S/R avec scipy</span>
    detect_breakouts()        <span class="code-comment"># Identifie cassures avec volume</span>

def get_latest_data_with_cached_levels():  <span class="code-comment"># API pour Scanner</span>
def create_chart():                        <span class="code-comment"># Graphiques Plotly</span>

@app.callback
def update_display():    <span class="code-comment"># âš¡ CÅ“ur du systÃ¨me - MAJ toutes les 60s</span>
        </div>

        <h3>Flux d'exÃ©cution :</h3>
        <div class="flow-diagram">
            <div>1. ğŸ“– Lit config.txt + sector_mapping.txt + settings.json</div>
            <div>â†“</div>
            <div>2. ğŸ”Œ Initialise MultiSourceDataProvider (mode backtest ou rÃ©el)</div>
            <div>â†“</div>
            <div>3. ğŸ¤– Initialise CatalystAnalyzer avec API Claude</div>
            <div>â†“</div>
            <div>4. ğŸ” Analyse historique complÃ¨te au dÃ©marrage (tous symboles)</div>
            <div>â†“</div>
            <div>5. ğŸŒ Lance serveur Dash sur port 8050</div>
            <div>â†“</div>
            <div>6. ğŸ”„ Boucle toutes les 60s : fetch â†’ cache S/R â†’ analyze â†’ display</div>
        </div>

        <h2 id="scanner">âš¡ scanner.py - Le Scanner CLI</h2>

        <div class="info-box">
            <strong>Scanner optimisÃ© pour surveillance continue</strong><br>
            618 lignes de code dÃ©diÃ©es Ã  la performance et au mode silencieux
        </div>

        <h3>Architecture :</h3>
        <div class="code-block">
class StockScanner:
    load_configuration()         <span class="code-comment"># Charge settings.json + config + secteurs</span>
    initialize_services()        <span class="code-comment"># Init data_provider + catalyst_analyzer</span>
    is_market_open()             <span class="code-comment"># VÃ©rifie heures marchÃ© US (9h30-16h EST)</span>
    scan_symbol()                <span class="code-comment"># âš¡ Core: analyse 1 symbole avec cache</span>
    should_alert_signal()        <span class="code-comment"># Applique filtres configurÃ©s</span>
    display_alert()              <span class="code-comment"># Affiche alerte formatÃ©e</span>
    scan_all_symbols()           <span class="code-comment"># Boucle sur tous les symboles</span>
    run_continuous_scan()        <span class="code-comment"># ğŸ”„ Scan continu avec refresh</span>
    cleanup_old_alerts()         <span class="code-comment"># Nettoie alertes >24h</span>

def detect_scanner_breakouts():  <span class="code-comment"># DÃ©tecte breakouts S/R</span>
        </div>

        <h3>CaractÃ©ristiques :</h3>
        <ul>
            <li>ğŸ”‡ <strong>Mode silencieux par dÃ©faut</strong> (<code>alerts_only: true</code>)</li>
            <li>ğŸ’¾ <strong>Utilise le cache intelligent</strong> via get_latest_data_with_cached_levels()</li>
            <li>âš¡ <strong>OptimisÃ© multi-symboles</strong> : peut gÃ©rer 50+ actions</li>
            <li>ğŸ• <strong>Respecte heures de marchÃ©</strong> : 9h30-16h EST, Lun-Ven uniquement</li>
            <li>ğŸ“Š <strong>MÃªme dÃ©tecteur</strong> : utilise catalyst_analyzer.py</li>
            <li>ğŸš« <strong>Anti-doublons</strong> : cooldown 30min (technique) / 2h (catalyst)</li>
            <li>ğŸ¯ <strong>Filtrage intelligent</strong> : profils configurables dans settings.json</li>
        </ul>

        <h3>Utilisation :</h3>
        <div class="command-box">
<span class="code-comment"># Lancement direct</span>
python3 scanner.py scanner_config.txt

<span class="code-comment"># Ou avec le script de contrÃ´le</span>
./run_scanner.sh start   <span class="code-comment"># DÃ©marre en arriÃ¨re-plan</span>
./run_scanner.sh stop    <span class="code-comment"># ArrÃªte le scanner</span>
./run_scanner.sh status  <span class="code-comment"># VÃ©rifie l'Ã©tat</span>

<span class="code-comment"># Logs</span>
tail -f scanner.log
        </div>

        <h3>DiffÃ©rences avec tabs.py :</h3>
        <table>
            <thead>
                <tr>
                    <th>Aspect</th>
                    <th>tabs.py (GUI)</th>
                    <th>scanner.py (CLI)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Interface</td>
                    <td>Web browser + graphiques</td>
                    <td>Terminal / logs uniquement</td>
                </tr>
                <tr>
                    <td>VerbositÃ©</td>
                    <td>Logs dÃ©taillÃ©s</td>
                    <td>Mode silencieux (alertes seulement)</td>
                </tr>
                <tr>
                    <td>Symboles</td>
                    <td>config.txt (5-10 symboles)</td>
                    <td>scanner_config.txt (50+ symboles)</td>
                </tr>
                <tr>
                    <td>Usage CPU</td>
                    <td>Moyen (graphiques)</td>
                    <td>Faible (texte seulement)</td>
                </tr>
                <tr>
                    <td>DÃ©ploiement</td>
                    <td>Local / dÃ©veloppement</td>
                    <td>Serveur / production</td>
                </tr>
            </tbody>
        </table>

        <h2 id="catalyst">ğŸ” catalyst_analyzer.py - DÃ©tection IA</h2>

        <div class="info-box">
            <strong>Intelligence artificielle pour comprendre les mouvements</strong><br>
            Utilise l'API Claude d'Anthropic pour analyser le contexte des catalyseurs
        </div>

        <h3>Fonctions principales :</h3>

        <h4>ğŸ¯ detect_significant_move()</h4>
        <div class="code-block">
def detect_significant_move(df, threshold):
    <span class="code-comment"># Seuil dynamique basÃ© sur volatilitÃ© historique</span>
    <span class="code-comment"># Par dÃ©faut : multiplier=1.5, min=1.0%</span>
    <span class="code-comment"># Exemple : Si vol moyenne = 2%, seuil = 3%</span>
        </div>

        <h4>ğŸ“° get_news_context()</h4>
        <div class="code-block">
def get_news_context(symbol):
    <span class="code-comment"># RÃ©cupÃ¨re news Yahoo Finance</span>
    <span class="code-comment"># Filtre sur derniÃ¨res 24h</span>
    <span class="code-comment"># Extrait titres + timestamps</span>
        </div>

        <h4>ğŸ¤– analyze_catalyst_with_ai()</h4>
        <div class="code-block">
def analyze_catalyst_with_ai(symbol, change_pct, sector, news):
    <span class="code-comment"># Envoie contexte complet Ã  Claude AI</span>
    <span class="code-comment"># Demande JSON structurÃ© en retour</span>
    <span class="code-comment"># Fallback basique si API indisponible</span>

    return {
        "type": "earnings",         <span class="code-comment"># Type de catalyseur</span>
        "description": "Beat EPS",  <span class="code-comment"># Description courte</span>
        "reliability": "high",      <span class="code-comment"># low|medium|high</span>
        "tradeable": true,          <span class="code-comment"># Peut-on trader ?</span>
        "reasoning": "..."          <span class="code-comment"># Explication dÃ©taillÃ©e</span>
    }
        </div>

        <h4>â° is_market_open()</h4>
        <div class="code-block">
def is_market_open(dt=None):
    <span class="code-comment"># VÃ©rifie heures marchÃ© US (9h30-16h EST)</span>
    <span class="code-comment"># DÃ©tecte weekends automatiquement</span>
    <span class="code-comment"># Utilise zoneinfo (Python 3.9+)</span>
        </div>

        <h3>Configuration API Claude :</h3>
        <div class="command-box">
<span class="code-comment"># CrÃ©er fichier .env</span>
echo 'ANTHROPIC_API_KEY="sk-ant-..."' > .env

<span class="code-comment"># Ou variable d'environnement</span>
export ANTHROPIC_API_KEY="sk-ant-..."
        </div>

        <div class="warning">
            <strong>âš ï¸ Fallback automatique :</strong><br>
            â€¢ Sans API key : analyse technique basique (type "technical")<br>
            â€¢ Avec API key : analyse contextuelle avancÃ©e avec news
        </div>

        <h2 id="backtest">ğŸ“ˆ backtest_catalysts.py - Backtesting</h2>

        <div class="success">
            <strong>Module de backtesting des stratÃ©gies de catalyseurs</strong><br>
            Permet de tester historiquement les performances des signaux dÃ©tectÃ©s
        </div>

        <h3>FonctionnalitÃ©s :</h3>
        <ul>
            <li>ğŸ“Š <strong>Replay historique</strong> : Simule la dÃ©tection sur donnÃ©es passÃ©es</li>
            <li>ğŸ’° <strong>Performance tracking</strong> : P&L, win rate, drawdown</li>
            <li>ğŸ¯ <strong>Test de filtres</strong> : Compare les diffÃ©rents profils</li>
            <li>ğŸ“ˆ <strong>Analyse par type</strong> : Performance par catalyst_type</li>
        </ul>

        <h3>Utilisation :</h3>
        <div class="command-box">
<span class="code-comment"># Backtest sur pÃ©riode donnÃ©e</span>
python3 backtest_catalysts.py --start 2024-01-01 --end 2024-12-31

<span class="code-comment"># Test d'un profil spÃ©cifique</span>
python3 backtest_catalysts.py --profile balanced

<span class="code-comment"># Export des rÃ©sultats</span>
python3 backtest_catalysts.py --output results.csv
        </div>

        <h2 id="providers">ğŸ“Š data_providers.py - Sources de donnÃ©es</h2>

        <div class="important">
            <strong>ğŸ†• NOUVEAU SYSTÃˆME DUAL-MODE :</strong><br>
            â€¢ <strong>Mode Backtest</strong> : Yahoo Finance + Cache CSV dans <code>data/</code><br>
            â€¢ <strong>Mode RÃ©el</strong> : IBKR direct (temps rÃ©el)
        </div>

        <h3>MultiSourceDataProvider - Deux modes :</h3>
        <div class="code-block">
class MultiSourceDataProvider:
    def __init__(self, backtest_mode=True):
        if backtest_mode:
            <span class="code-comment"># Mode backtest : Yahoo + CSV cache</span>
            <span class="code-comment"># 1. Cherche dans data/SYMBOL.csv</span>
            <span class="code-comment"># 2. Si pas de cache : tÃ©lÃ©charge Yahoo et sauvegarde</span>
            providers = [YahooFinanceProvider()]
        else:
            <span class="code-comment"># Mode rÃ©el : IBKR uniquement</span>
            <span class="code-comment"># Connexion directe Ã  Interactive Brokers</span>
            providers = [IBKRProvider()]
        </div>

        <h3>SystÃ¨me de Cache CSV :</h3>
        <div class="success">
            <strong>âœ¨ Performance optimale pour backtests</strong><br>
            â€¢ Fichiers CSV stockÃ©s dans <code>data/SYMBOL.csv</code><br>
            â€¢ TÃ©lÃ©chargement unique depuis Yahoo Finance<br>
            â€¢ RÃ©utilisation instantanÃ©e pour backtests suivants<br>
            â€¢ Pas de timeout le week-end ou hors heures de marchÃ©
        </div>

        <h4>Fonctions de cache :</h4>
        <div class="code-block">
<span class="code-comment"># Charger depuis cache</span>
cached_df = load_from_cache(symbol, days=150)

<span class="code-comment"># Sauvegarder dans cache</span>
save_to_cache(symbol, df)

<span class="code-comment"># Chemin : data/NVDA.csv, data/AAPL.csv, etc.</span>
        </div>

        <h3>Configuration du mode :</h3>
        <div class="code-block">
<span class="code-comment"># Dans settings.json</span>
"debug": {
  "replay_mode": true,   <span class="code-comment">// true = backtest, false = rÃ©el</span>
  "candle_offset": 10
}
        </div>

        <h3>Comparaison des modes :</h3>
        <table>
            <thead>
                <tr>
                    <th>Mode</th>
                    <th>Source</th>
                    <th>Avantages</th>
                    <th>Usage</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Backtest</strong><br>(replay_mode: true)</td>
                    <td>Yahoo Finance<br>+ CSV cache</td>
                    <td>â€¢ Pas de timeout<br>â€¢ Marche week-end<br>â€¢ Ultra rapide (cache)<br>â€¢ Gratuit</td>
                    <td>DÃ©veloppement<br>Tests<br>Backtesting</td>
                </tr>
                <tr>
                    <td><strong>RÃ©el</strong><br>(replay_mode: false)</td>
                    <td>IBKR direct</td>
                    <td>â€¢ Temps rÃ©el<br>â€¢ DonnÃ©es broker<br>â€¢ Tick-by-tick<br>â€¢ FiabilitÃ© max</td>
                    <td>Trading live<br>Production</td>
                </tr>
            </tbody>
        </table>

        <h3>Workflow du cache :</h3>
        <div class="flow-diagram">
            <div>1. ğŸ” Check si data/SYMBOL.csv existe</div>
            <div>â†“</div>
            <div>2a. âœ… Cache HIT â†’ Lecture instantanÃ©e</div>
            <div>2b. âŒ Cache MISS â†’ TÃ©lÃ©chargement Yahoo</div>
            <div>â†“</div>
            <div>3. ğŸ’¾ Sauvegarde dans data/ (365 jours d'historique)</div>
            <div>â†“</div>
            <div>4. ğŸ“Š Retourne les donnÃ©es demandÃ©es</div>
        </div>

        <h2 id="alerts">ğŸš¨ Types d'alertes dÃ©tectÃ©es</h2>

        <h3>1. Catalyseurs IA (ğŸ¤–)</h3>
        <table>
            <thead>
                <tr>
                    <th>Type</th>
                    <th>DÃ©clencheur</th>
                    <th>Exemple</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>earnings</code></td>
                    <td>RÃ©sultats trimestriels</td>
                    <td>"NVDA bat les prÃ©visions EPS"</td>
                </tr>
                <tr>
                    <td><code>fda</code></td>
                    <td>Approbation mÃ©dicament</td>
                    <td>"FDA approuve traitement RYTM"</td>
                </tr>
                <tr>
                    <td><code>acquisition</code></td>
                    <td>Rachat d'entreprise</td>
                    <td>"Microsoft rachÃ¨te startup IA"</td>
                </tr>
                <tr>
                    <td><code>contract</code></td>
                    <td>Gros contrat commercial</td>
                    <td>"Contrat militaire $500M"</td>
                </tr>
                <tr>
                    <td><code>crypto_move</code></td>
                    <td>Mouvement liÃ© aux cryptos</td>
                    <td>"Bitcoin +15% â†’ COIN monte"</td>
                </tr>
                <tr>
                    <td><code>technical</code></td>
                    <td>Pas de news identifiable</td>
                    <td>"Mouvement technique pur"</td>
                </tr>
                <tr>
                    <td><code>macro</code></td>
                    <td>Ã‰vÃ©nement macroÃ©conomique</td>
                    <td>"Fed change taux intÃ©rÃªt"</td>
                </tr>
            </tbody>
        </table>

        <h3>2. Breakouts techniques (ğŸ”§)</h3>
        <div class="code-block">
<span class="code-comment"># Conditions pour alerter :</span>
âœ… Mouvement minimum â‰¥ 1.0% (configurable)
âœ… Volume spike â‰¥ 1.5x moyenne
âœ… Close confirmÃ© au-delÃ  du niveau S/R
âœ… Niveau dÃ©tectÃ© par algorithme (order=5)
        </div>

        <table>
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Signal</th>
                    <th>InterprÃ©tation</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>resistance_breakout</code></td>
                    <td>Prix casse rÃ©sistance â†‘</td>
                    <td>Signal haussier - continuation probable</td>
                </tr>
                <tr>
                    <td><code>support_breakdown</code></td>
                    <td>Prix casse support â†“</td>
                    <td>Signal baissier - poursuite de baisse</td>
                </tr>
            </tbody>
        </table>

        <h3>Exemple d'alerte :</h3>
        <div class="command-box">
ğŸš¨ CATALYST DÃ‰TECTÃ‰ - NVDA
ğŸ’° Prix: $521.43 (ğŸ“ˆ +8.5%)
ğŸ” Type: EARNINGS
â­ FiabilitÃ©: HIGH
ğŸ’¼ Tradeable: âœ… OUI
ğŸ¢ Secteur: tech
ğŸ—ï¸ News: "NVIDIA beats Q3 earnings expectations..."
ğŸ¤– Raisonnement: Strong earnings beat with AI chip demand...
        </div>

        <div class="command-box">
ğŸ”§ BREAKOUT TECHNIQUE - MSFT
ğŸ’° Prix: $515.29 (ğŸ“‰ -2.1%)
ğŸ” Type: SUPPORT BREAKDOWN
ğŸ“ Niveau: $516.70
â¡ï¸ Direction: DOWN
âš¡ Signal: TECHNIQUE
        </div>

        <h2 id="commands">ğŸ› ï¸ Commandes utiles</h2>

        <h3>Lancement rapide :</h3>
        <div class="command-box">
<span class="code-comment"># GUI Dashboard</span>
cd /home/user/screener
python3 tabs.py config.txt
<span class="code-comment"># AccÃ¨s : http://localhost:8050</span>

<span class="code-comment"># CLI Scanner</span>
python3 scanner.py scanner_config.txt

<span class="code-comment"># Scanner en arriÃ¨re-plan</span>
./run_scanner.sh start
./run_scanner.sh stop
./run_scanner.sh status
        </div>

        <h3>Gestion des processus :</h3>
        <div class="command-box">
<span class="code-comment"># Trouver le processus</span>
ps aux | grep scanner.py

<span class="code-comment"># Tuer le processus</span>
pkill -f scanner.py

<span class="code-comment"># Voir les logs</span>
tail -f scanner.log
        </div>

        <h3>Configuration :</h3>
        <div class="command-box">
<span class="code-comment"># Ã‰diter symboles surveillÃ©s</span>
nano config.txt              <span class="code-comment"># Pour GUI</span>
nano scanner_config.txt      <span class="code-comment"># Pour Scanner</span>

<span class="code-comment"># Ã‰diter configuration avancÃ©e</span>
nano settings.json

<span class="code-comment"># Ã‰diter secteurs</span>
nano sector_mapping.txt
        </div>

        <h2 id="debug">ğŸ› DÃ©pannage</h2>

        <h3>ProblÃ¨mes courants :</h3>

        <div class="error-help">
            <strong>"No data for SYMBOL"</strong><br>
            â†’ Le symbole n'existe pas ou n'est pas disponible sur les providers<br>
            â†’ VÃ©rifiez l'orthographe dans config.txt
        </div>

        <div class="error-help">
            <strong>"Port 8050 already in use"</strong><br>
            â†’ Une instance de tabs.py tourne dÃ©jÃ <br>
            â†’ Solution : <code>pkill -f tabs.py</code> ou changez le port dans settings.json
        </div>

        <div class="error-help">
            <strong>"Catalyst Analyzer non disponible"</strong><br>
            â†’ ProblÃ¨me API Claude ou clÃ© manquante<br>
            â†’ Le systÃ¨me continue avec fallback basique
        </div>

        <div class="error-help">
            <strong>"âš ï¸ MarchÃ© fermÃ©, analyse ignorÃ©e"</strong><br>
            â†’ Normal ! Le systÃ¨me ne surveille que pendant heures de marchÃ© US<br>
            â†’ Lundi-Vendredi 9h30-16h EST
        </div>

        <div class="error-help">
            <strong>"Scanner tourne mais aucune alerte"</strong><br>
            â†’ VÃ©rifiez le profil actif dans settings.json<br>
            â†’ Profil "no_filters" pour tout voir<br>
            â†’ VÃ©rifiez <code>"alerts_only": true</code> dans logging
        </div>

        <div class="error-help">
            <strong>"IBKR: Historical data timeout" ou "Historical data farm: Inactive"</strong><br>
            â†’ IBKR n'est pas disponible (week-end ou hors heures)<br>
            â†’ <strong>Solution :</strong> Activez le mode backtest dans settings.json :<br>
            <code>"debug": { "replay_mode": true }</code><br>
            â†’ Le systÃ¨me utilisera Yahoo Finance + cache CSV automatiquement
        </div>

        <div class="success">
            <strong>ğŸ’¡ ASTUCE : Mode backtest par dÃ©faut</strong><br>
            En mode backtest (<code>replay_mode: true</code>), le systÃ¨me :<br>
            â€¢ Utilise Yahoo Finance + cache CSV dans <code>data/</code><br>
            â€¢ Fonctionne 24/7, mÃªme week-end<br>
            â€¢ Pas de timeout IBKR<br>
            â€¢ Performance optimale (cache instantanÃ©)<br>
            <br>
            Passez en mode rÃ©el (<code>replay_mode: false</code>) uniquement pour trading live avec IBKR.
        </div>

        <h3>Mode debug :</h3>
        <div class="code-block">
<span class="code-comment"># Activer logs dÃ©taillÃ©s dans settings.json</span>
"logging": {
  "debug": true,
  "alerts_only": false    <span class="code-comment">// Voir tous les logs</span>
}

<span class="code-comment"># Mode replay pour tester</span>
"debug": {
  "candle_offset": 10,    <span class="code-comment">// Tester bougie passÃ©e</span>
  "replay_mode": true
}
        </div>

        <h3>Performance :</h3>
        <ul>
            <li><strong>Scanner lent ?</strong> â†’ RÃ©duire nombre de symboles dans scanner_config.txt</li>
            <li><strong>MÃ©moire Ã©levÃ©e ?</strong> â†’ Le cache est en RAM, c'est normal</li>
            <li><strong>CPU Ã©levÃ© ?</strong> â†’ Augmenter <code>refresh_seconds</code> dans settings.json</li>
            <li><strong>Trop d'alertes ?</strong> â†’ Utiliser profil "high_confidence" ou augmenter seuils</li>
        </ul>

        <div class="success">
            <h3>ğŸš€ Bonnes pratiques</h3>
            <ul style="text-align: left;">
                <li>âœ… Utilisez <strong>GUI</strong> pour l'analyse dÃ©taillÃ©e pendant la journÃ©e</li>
                <li>âœ… Utilisez <strong>Scanner</strong> en continu sur serveur avec <code>run_scanner.sh</code></li>
                <li>âœ… Activez <code>alerts_only</code> en production pour Ã©viter pollution de logs</li>
                <li>âœ… Choisissez le profil <strong>balanced</strong> pour commencer</li>
                <li>âœ… Configurez API Claude pour analyse contextuelle avancÃ©e</li>
                <li>âœ… Ajustez les seuils selon votre tolÃ©rance au bruit</li>
            </ul>
        </div>

        <div class="info-box">
            <h3>ğŸ’¡ Personnalisation avancÃ©e</h3>
            <p><strong>CrÃ©er votre propre profil de filtrage :</strong></p>
            <div class="code-block">
"signal_filters": {
  "active_profile": "my_custom_profile",
  "profiles": {
    "my_custom_profile": {
      "enabled": true,
      "allowed_breakout_types": ["resistance_breakout"],
      "allowed_catalyst_types": ["earnings", "fda"],
      "blocked_catalyst_types": ["technical"],
      "min_reliability": "high",
      "min_change_percent": 3.0,
      "require_volume_spike": true,
      "allowed_sectors": ["tech", "biotech"]
    }
  }
}
            </div>
        </div>

        <footer style="text-align: center; margin-top: 40px; padding: 20px; border-top: 2px solid #ddd; color: #666;">
            <p>ğŸ“š Documentation mise Ã  jour le 09/11/2025</p>
            <p>ğŸ“Š Stock Screener - Version 3.2</p>
            <p>âš¡ Dual-mode (Backtest: Yahoo+CSV cache | RÃ©el: IBKR direct)</p>
            <p>âœ¨ Nouveau : Cache S/R intelligent (TTL 4h) + Anti-doublons + Filtrage avancÃ©</p>
        </footer>
    </div>
</body>
</html>
